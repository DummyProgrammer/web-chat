<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Screen Recording Test</title>
  <style>
    /* Style for the modal (mini-window) */
    #miniWindow {
      display: none; /* hidden by default */
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #f9f9f9;
      padding: 20px 30px;
      border: 2px solid #333;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      text-align: center;
    }

    /* Overlay behind the mini-window */
    #overlay {
      display: none; /* hidden by default */
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 500;
    }

    input[type="text"] {
      padding: 5px;
      font-size: 14px;
      width: 250px;
    }

    button {
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Enter Conversation GUID</h2>
  <input type="text" id="guidInput" placeholder="Enter Conversation ID here">
  <button id="submitBtn">Submit</button>

  <!-- Overlay -->
  <div id="overlay"></div>

  <!-- Mini-window -->
<div id="miniWindow">
  <p id="statusText">Recording Paused</p>
  <button id="saveBtn">Save</button>
</div>

  <script>
    const submitBtn = document.getElementById('submitBtn');
    const miniWindow = document.getElementById('miniWindow');
    const overlay = document.getElementById('overlay');
    const saveBtn = document.getElementById('saveBtn');
    const guidInput = document.getElementById('guidInput');
    const statusText = document.getElementById('statusText');

    // Genesys Recording API configuration
    const API_BASE = 'https://api.usw2.pure.cloud/api/v2/conversations/calls';
    const AUTH_TOKEN = 'ybmJHrjcIk23Z379bUOChX4-DvYZIwH8N_BbaEyDvS-CD1jcXypVFI7YctDy_35EikZ9uRxm1uKZUPsd6luj4w'; // replace with your actual token

    // Helper function to call Genesys API
    async function callGenesysAPI(conversationId, recordingState) {
      try {
        const response = await fetch(`${API_BASE}/${conversationId}/recordingstate`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${AUTH_TOKEN}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ recordingState }) // "paused" or "active"

        });

        if (response.ok) {
          return { success: true };
        } else {
          const errorData = await response.json();
          return { success: false, message: errorData.message || response.statusText };
        }
      } catch (err) {
        return { success: false, message: err.message };
      }
    }

    // Submit button: pause recording
    submitBtn.addEventListener('click', async () => {
      const conversationId = guidInput.value.trim();
      if (!conversationId) {
        alert('Please enter a Conversation ID (GUID) before submitting!');
        return;
      }

      miniWindow.style.display = 'block';
      overlay.style.display = 'block';
      statusText.textContent = 'Pausing recording...';

      const result = await callGenesysAPI(conversationId, 'PAUSED');
      if (result.success) {
        statusText.textContent = 'Recording Paused';
      } else {
        statusText.textContent = `Error: ${result.message}`;
      }
    });

    // Save button: resume recording
    saveBtn.addEventListener('click', async () => {
      const conversationId = guidInput.value.trim();
      if (!conversationId) {
        alert('Conversation ID missing!');
        return;
      }

      statusText.textContent = 'Resuming recording...';

      const result = await callGenesysAPI(conversationId, 'ACTIVE');
      if (result.success) {
        statusText.textContent = 'Recording Resumed';
        // Close mini-window after a short delay
        setTimeout(() => {
          miniWindow.style.display = 'none';
          overlay.style.display = 'none';
          guidInput.value = '';
        }, 1000);
      } else {
        statusText.textContent = `Error: ${result.message}`;
      }
    });

    // Close modal if user clicks overlay
    overlay.addEventListener('click', () => {
      miniWindow.style.display = 'none';
      overlay.style.display = 'none';
    });
  </script>

</body>
</html>